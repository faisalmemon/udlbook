% Problem 6.3

\documentclass{article}

\usepackage{geometry}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{breqn} 
\usepackage{verbatim}

\title{Problem 6.3}

\begin{document}

\section{Problem}

Compute the derivatives of the least squares loss $ L [ \phi ] $  with respect to $ \phi_0 $ and $\phi_1$ for the Gabor model equation 6.8. 

\section{Answer}

\begin{align}
    f[x,\phi] &= \sin(\phi_0 + 0.06 \cdot \phi_1x) \cdot \exp  \left( \frac{-(\phi_0 + 0.06 \cdot \phi_1x)^2}{32.0} \right)
    \\
    L[\phi]   &= \sum_{i=1}^{I} (f[x_i, \phi]-y_i)^2
\end{align}

\begin{align*}
\text{Let } u_i &= f[x_i, \phi]-y_i \\
\text{Then } L [\phi] &= \sum_{i=1}^{I} (u_i)^2 \\
\frac{\partial{L[\phi]}}{\partial{\phi_0}} &= \sum_{i=1}^{I}  \frac{\partial{L[\phi]}}{\partial{u_i}} \cdot \
 \frac{\partial{u_i}}{\partial{\phi_0}}
 \\
 \text{Let us break it down } \frac{\partial{L[\phi]}}{\partial{u_i}} &= 2 \cdot u_i = 2 \cdot \left( \sin(\phi_0 + 0.06 \cdot \phi_1x) \cdot \exp  \left( \frac{-(\phi_0 + 0.06 \cdot \phi_1x_i)^2}{32.0} \right) - y_i \right)
 \\
 \frac{\partial{u_i}}{\partial{\phi_0}} &= \frac{\partial{\sin(\phi_0 + 0.06 \cdot \phi_1x) \cdot \exp  \left( \frac{-(\phi_0 + 0.06 \cdot \phi_1x_i)^2}{32.0} \right)}}{\partial{\phi_0}} \\
 \text{Let } p &= \sin(\phi_0 + 0.06 \cdot \phi_1x_i) \\
 \text{Let } q &= \exp  \left( \frac{-(\phi_0 + 0.06 \cdot \phi_1x_i)^2}{32.0} \right) \\
 \text{So that } \frac{\partial{u_i}}{\partial{\phi_0}} &= p\frac{\partial{q}}{\partial{\phi_0}} + q \frac{\partial{p}}{\partial{\phi_0}}
 \\
 \text{Let } r &= \phi_0 + 0.06 \cdot \phi_1 x_i
 \\
 \text{So that } \frac{\partial{p}}{\partial{\phi_0}} &= \frac{\partial{\sin(r)}}{\partial{r}} \cdot \frac{\partial{r}}{\partial{\phi_0}} = \cos (r) \cdot (1) = \cos(\phi_0 + 0.06\cdot \phi_1 x_i)
 \\
 \text{Let } s &= \left( \frac{-(\phi_0 + 0.06 \cdot \phi_1x_i)^2}{32.0} \right)
 \\
 \text{So that} \frac{\partial{q}}{\partial{\phi_0}} &= \frac{\partial{\exp(s)}}{\partial{s}} \cdot \frac{\partial{s}}{\partial{\phi_0}} = \exp(s) \cdot \frac{\partial{s}}{\partial{\phi_0}}
 \\
 \text{Let }t &= \phi_0 + 0.06 \cdot \phi_1x_i
 \\
 \text{So that } \frac{\partial{s}}{\partial{\phi_0}} &= \frac{\partial{\frac{-1}{32}}t^2}{\partial{t}} \cdot \frac{\partial{t}}{\partial{\phi_0}} = \frac{-1}{16} \cdot ( \phi_0 + 0.06 \cdot \phi_1x_i ) \cdot (1) = -\frac{\phi_0 + 0.06 \cdot \phi_1x_i}{16}
 \\
 \text{Substituting } \frac{\partial{q}}{\partial{\phi_0}} &= \exp(s) \cdot  -\frac{\phi_0 + 0.06 \cdot \phi_1x_i}{16} = -\frac{\phi_0 + 0.06 \cdot \phi_1x_i}{16} \cdot \exp \left( \frac{-(\phi_0 + 0.06 \cdot \phi_1x_i)^2}{32.0} \right)
 \\
 \text{Similarly } \frac{\partial{p}}{\partial{\phi_0}} &= \cos(\phi_0 + 0.06\cdot \phi_1 x_i)
 \\
 \text{So that } \frac{\partial{u_i}}{\partial{\phi_0}} &= \sin(\phi_0 + 0.06 \cdot \phi_1x_i) \cdot -\frac{\phi_0 + 0.06 \cdot \phi_1x_i}{16} \cdot \exp \left( \frac{-(\phi_0 + 0.06 \cdot \phi_1x_i)^2}{32.0} \right) \\
 &+ \exp  \left( \frac{-(\phi_0 + 0.06 \cdot \phi_1x_i)^2}{32.0} \right) \cdot \cos(\phi_0 + 0.06\cdot \phi_1 x_i)
\end{align*}


\begin{dmath*}
    \text{Finally } \frac{\partial{L[\phi]}}{\partial{\phi_0}} = \sum_{i=1}^{I} 2 \cdot \left( \sin(\phi_0 + 0.06 \cdot \phi_1x) \cdot \exp  \left( \frac{-(\phi_0 + 0.06 \cdot \phi_1x_i)^2}{32.0} \right) - y_i \right) \\
    \cdot  \left[ \sin(\phi_0 + 0.06 \cdot \phi_1x_i) \cdot -\frac{\phi_0 + 0.06 \cdot \phi_1x_i}{16} \cdot \exp \left( \frac{-(\phi_0 + 0.06 \cdot \phi_1x_i)^2}{32.0} \right) + \exp  \left( \frac{-(\phi_0 + 0.06 \cdot \phi_1x_i)^2}{32.0} \right) \cdot \cos(\phi_0 + 0.06\cdot \phi_1 x_i) \right]
\end{dmath*}

\section{Using SymPy}

\begin{verbatim}
>>> L
    (-y + exp(-0.03125*(phi0 + 0.06*phi1*x)**2)*sin(phi0 + 0.06*phi1*x))**2
>>> print(latex(diff(L,phi0)))
    \left(- y + e^{- 0.03125 \left(\phi_{0} + 0.06 \phi_{1} x\right)^{2}} 
    \sin{\left(\phi_{0} + 0.06 \phi_{1} x \right)}\right) \left(2 
    \left(- 0.0625 \phi_{0} - 0.00375 \phi_{1} x\right) e^{- 0.03125 
    \left(\phi_{0} + 0.06 \phi_{1} x\right)^{2}} \sin{\left(\phi_{0} + 0.06 
    \phi_{1} x \right)} + 2 e^{- 0.03125 \left(\phi_{0} + 0.06 \phi_{1} 
    x\right)^{2}} \cos{\left(\phi_{0} + 0.06 \phi_{1} x \right)}\right)
>>> print(latex(diff(L,phi1)))
    \left(- y + e^{- 0.03125 \left(\phi_{0} + 0.06 \phi_{1} x\right)^{2}} 
    \sin{\left(\phi_{0} + 0.06 \phi_{1} x \right)}\right) \left(- 0.0075 x 
    \left(\phi_{0} + 0.06 \phi_{1} x\right) e^{- 0.03125 \left(\phi_{0} + 
    0.06 \phi_{1} x\right)^{2}} \sin{\left(\phi_{0} + 0.06 \phi_{1} x 
    \right)} + 0.12 x e^{- 0.03125 \left(\phi_{0} + 0.06 \phi_{1} x\right)^{2}} 
    \cos{\left(\phi_{0} + 0.06 \phi_{1} x \right)}\right)
    >>> 1/16
    0.0625
    >>> 1/32
    0.03125
    >>> 3/800
    0.00375
    >>> 3/400
    0.0075
    >>> 3/25
    0.12
    

\end{verbatim}

\begin{dmath*}
    \frac{\partial{L[\phi]}}{\partial{\phi_0}} = \
    \left(- y_{i} + e^{- \frac{1}{32} \left(\phi_{0} + 0.06 \phi_{1} x\right)^{2}} \sin{\left(\phi_{0} + 0.06 \phi_{1} x \right)}\right) \cdot \newline \left(2 \left(- \frac{1}{16} \phi_{0} - \frac{3}{800} \phi_{1} x\right) e^{- \frac{1}{32} \left(\phi_{0} + 0.06 \phi_{1} x\right)^{2}} \sin{\left(\phi_{0} + 0.06 \phi_{1} x \right)} + 2 e^{- \frac{1}{32} \left(\phi_{0} + 0.06 \phi_{1} x\right)^{2}} \cos{\left(\phi_{0} + 0.06 \phi_{1} x \right)}\right)
\end{dmath*}

\begin{dmath*}
    \frac{\partial{L[\phi]}}{\partial{\phi_1}} = \
    \left(- y_{i} + e^{- \frac{1}{32} \left(\phi_{0} + 0.06 \phi_{1} x\right)^{2}} \sin{\left(\phi_{0} + 0.06 \phi_{1} x \right)}\right) \left(- \frac{3}{400} x \left(\phi_{0} + 0.06 \phi_{1} x\right) e^{- \frac{1}{32} \left(\phi_{0} + 0.06 \phi_{1} x\right)^{2}} \sin{\left(\phi_{0} + 0.06 \phi_{1} x \right)} + 0.12 x e^{- \frac{1}{32} \left(\phi_{0} + 0.06 \phi_{1} x\right)^{2}} \cos{\left(\phi_{0} + 0.06 \phi_{1} x \right)}\right)
\end{dmath*}

\end{document}